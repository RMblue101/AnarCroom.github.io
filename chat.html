<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANARCROOM - Sala</title>
<link rel="stylesheet" href="static/anarcroom.css">
</head>
<body>
<div class="container">
  <div class="anarcho-logo">A</div>
  <h1>ANARCROOM</h1>
  <p id="roomLabel"></p>
  <div id="joinSection">
    <input id="user" placeholder="Nome do utilizador">
    <button onclick="entrar()">Entrar</button>
  </div>
  <div id="chat" style="display:none">
    <div id="messages"></div>
    <input id="msg" placeholder="Mensagem">
    <button onclick="enviar()">Enviar</button>
    <br><br>
    <a href="index.html">‚Üê Voltar</a>
  </div>
</div>

<script>
// Static client-only chat using localStorage. Works on GitHub Pages.
const params = new URLSearchParams(window.location.search);
const room = params.get('room') || 'default';
document.getElementById('roomLabel').textContent = 'Sala: ' + room;

let username = '';

function loadMessages() {
  const key = 'anarcroom_msgs_' + room;
  const arr = JSON.parse(localStorage.getItem(key) || '[]');
  const container = document.getElementById('messages');
  container.innerHTML = '';
  arr.forEach(m => {
    const p = document.createElement('p');
    const t = new Date(m.time).toLocaleTimeString();
    p.textContent = `[${t}] ${m.user}: ${m.msg}`;
    container.appendChild(p);
  });
  container.scrollTop = container.scrollHeight;
}

window.entrar = function() {
  username = document.getElementById('user').value.trim();
  if (!username) return alert('Escolhe um nome');
  document.getElementById('joinSection').style.display = 'none';
  document.getElementById('chat').style.display = 'block';
  loadMessages();
  document.getElementById('msg').focus();
};

window.enviar = function() {
  const textEl = document.getElementById('msg');
  const txt = textEl.value.trim();
  if (!txt) return;
  const key = 'anarcroom_msgs_' + room;
  const arr = JSON.parse(localStorage.getItem(key) || '[]');
  const msg = {
    user: username,
    msg: txt,
    time: new Date().toISOString()
  };
  arr.push(msg);
  localStorage.setItem(key, JSON.stringify(arr));
  textEl.value = '';
  loadMessages();
};

document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && document.activeElement.id === 'msg') enviar();
});
</script>
</body>
</html>
